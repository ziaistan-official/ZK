name: BUILD APK NEW Automatic

on:
  push:                # no branches filter â€” runs on push to any branch
  pull_request:        # runs on PRs targeting any branch
  workflow_dispatch:   # manual trigger

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Setup Gradle
        uses: gradle/actions/setup-gradle@v4

      - name: Generate Temporary Release Keystore
        run: |
          keytool -genkeypair \
            -dname "CN=GitHub Actions, OU=Automated Build, O=Open Source, L=Unknown, ST=Unknown, C=US" \
            -keystore release.keystore \
            -alias release-alias \
            -storepass insecure_password_123 \
            -keypass insecure_password_123 \
            -keyalg RSA -keysize 2048 -validity 1

      - name: Make Gradle wrapper executable
        run: chmod +x ./gradlew

      - name: Build (assembleRelease) using wrapper
        run: ./gradlew assembleRelease
        env:
          RELEASE_KEYSTORE: release.keystore
          RELEASE_KEYSTORE_PASSWORD: "insecure_password_123"
          RELEASE_KEY_ALIAS: "release-alias"
          RELEASE_KEY_PASSWORD: "insecure_password_123"

      - name: Upload Release APK as Artifact
        uses: actions/upload-artifact@v4
        with:
          name: release-apk-${{ github.run_number }}
          path: build/outputs/apk/release/*.apk
